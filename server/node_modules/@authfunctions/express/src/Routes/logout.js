const { onTrigger, useTrigger, sendData, sendError } = require("../utils")
const jwt = require("jsonwebtoken")

//logout a user on the server
module.exports = async (req, res) => {
  //send error if there is no token
  if (!req.body.token) return sendError(31, res);

  //trigger "delete-token" to delete the token on the server
  const [err, notin] = await useTrigger("delete-token", req.body.token);

  //send error if errors occured in "delete-token"
  if (err) return sendError(5, res);

  //send error if token couldn't be deleted beacuse it hasn't existed on the server
  if (notin) return sendError(32, res);

  //trigger logout function with the decoded information from the token of the user
  onTrigger("logout", jwt.decode(req.body.token));

  //send empty response to client
  return sendData(30, res, {});
}